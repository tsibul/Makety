{% extends 'maket/main.html' %}
{% block title %}Администрирование{% endblock %}
{% block content %}

<!-- Modal delete Maket-->
<div class="modal fade" id="deleteMaketModal" tabindex="-1" aria-labelledby="deleteMaketModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteMaketModalLabel">Вы удаляете макет</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      <form action="delete_maket" id="form_delete_maket" method="post">
     {% csrf_token %}
        <input type="hidden" name="object_to_delete" value="" id="object_to_delete" form="form_delete_maket">
      </form>
        <div class="row pe-3 justify-content-evenly">
            <div class="col-3" id="object_no"></div>
            <div class="col-1 text-start "> от </div>
            <div class="col-2 text-start" id="object_date"></div>
        </div>
            <div class="row ps-2" id="object_customer"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
        <button type="submit" class="btn btn-danger" form="form_delete_maket">Все равно удалить</button>
      </div>
    </div>
  </div>
</div><!-- Modal delete Maket-->


<table class="table table-hover">
    <thead>
    <tr onclick="javascript:colapse_('item_imports');" class="table-primary">
        <th colspan="2">несвязанные товарные позиции</th>
        <th colspan="2" class="text-danger text-end">всего</th>
        <th colspan="2" class="text-danger text-start">{{lost_imports_len}}</th>
        <th colspan="3"></th>
    </tr>
    </thead>
    <tbody id="collapse_item_imports" >
    {% for l_i in lost_imports %}
    <tr>
        <form action="lost_imports/{{l_i.0.id}}" id="form_lost_import_{{l_i.0.id}}" method="post">
        {% csrf_token %}
        <input type="text" hidden name="l_import" value="{{l_i.0.id}}">
        <input type="text" hidden name="l_det" value="{{l_i.1.id}}">
        </form>
        <td style="max-width:360px;">{{l_i.0.order.order_id}}</td>
        <td style="max-width:360px;">{{l_i.0.order.customer.name}}</td>
        <td style="max-width:360px;">{{l_i.0.name}}</td>
        <td>{{l_i.0.code}}</td>
        <td>{{l_i.0.print_name}}</td>
        <td class="text-danger fw-bold"> <= </td>
        <td>{{l_i.1.name}}</td>
        <td>{{l_i.1.item_name}}</td>
        <td><button type="submit" form="form_lost_import_{{l_i.0.id}}" class="btn btn-sm btn-outline-primary text-nowrap">
            установить связь
        </button></td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<table class="table table-hover">
    <thead>
    <tr onclick="javascript:colapse_('lost_makets');" class="table-primary">
        <th colspan="5">несвязанные макеты</th>
        <th colspan="3" class="text-danger text-end">всего</th>
        <th colspan="2" class="text-danger text-start">{{lost_makets_len}}</th>
        <th colspan="1" class="text-danger text-start"></th>
    </tr>
    </thead>
    <tbody id="collapse_lost_makets" >
    {% for l_m in lost_makets %}
    <tr>
        <form action="lost_maket/{{l_m.0.id}}" id="form_lost_maket_{{l_m.0.id}}" method="post">
        {% csrf_token %}
        <input type="text" hidden name="l_maket" value="{{l_m.0.id}}">
        <input type="text" hidden name="l_order" value="{{l_m.1.id}}">
        </form>
        <td style="max-width:360px;">макет</td>
        <td style="max-width:360px;" id="order_num_{{l_m.0.id}}">{{l_m.0.order_num}}</td>
        <td style="max-width:360px;" id="order_date_{{l_m.0.id}}">{{l_m.0.order_date| date:'d.m.Y'}}</td>
        <td style="max-width:360px;">{{l_m.0.maket_id}}</td>
        <td class="text-danger fw-bold"> <= </td>
        <td style="max-width:360px;">заказ</td>
        <td>{{l_m.1.order_id}}</td>
        <td>{{l_m.1.order_date|date:'d.m.Y'}}</td>
        <td id="customer_name_{{l_m.0.id}}">{{l_m.1.customer.name}}</td>

        <td><button type="submit" form="form_lost_maket_{{l_m.0.id}}" class="btn btn-sm btn-outline-primary text-nowrap">
            установить связь
        </button></td>
        <td><button type="button"  class="btn btn-sm btn-outline-danger text-nowrap" data-bs-toggle="modal"
                    data-bs-target="#deleteMaketModal" onclick="javascript:delete_object_modal({{l_m.0.id}});">
            <i class="bi bi-x-lg"></i> удалить макет
        </button></td>
    </tr>
    {% endfor %}
    </tbody>
</table>



{% endblock %}